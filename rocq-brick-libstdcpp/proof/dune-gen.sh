#!/bin/sh
#
# Copyright (C) 2020-2025 BlueRock Security, Inc.
#
# This software is distributed under the terms of the BedRock Open-Source License.
# See the LICENSE-BedRock file in the repository root for details.
#

target=dune.inc

usage() {
	cat >&2 <<-EOF
		usage: $(basename "$0")

		This will invoke ./cpp2v-dune-gen.sh for every C or C++ file under
		the current directory, sending the dune rules to ${target}.
	EOF
        exit 1
}

[ $# = 0 ] || usage

exec > ${target}

echo "; DO NOT EDIT: Generated by \"$0${1+ $*}\""

# Temporary: `cpp2v --templates` for only those tests in ./templates.

# Blacklist some files for arch_indep
find . -name '*.[ch]pp' |
sort |
while read i; do
  ./cpp2v-dune-gen.sh -s -- $i -- -std=c++20 -stdlib=libstdc++
done
